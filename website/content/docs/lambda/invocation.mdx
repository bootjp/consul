---
layout: docs
page_title: Invoke Lambda Functions
description: >-
  This topic describes how to invoke AWS Lambda functions from the Consul service mesh.
---

# Invoke Lambda Functions

This topic describes how to invoke AWS Lambda functions from the Consul service mesh.

## Overview

You can invoke Lambda functions from the Consul service mesh through terminating gateways (recommended) or directly from connect proxies.

We recommend invoking Lambda functions through terminating gateways because Consul intentions and transparent proxy are unsupported when invoking Lambda functions through connect proxies. 

### Terminating Gateway

We recommend invoking Lambda functions through terminating gateways. This method supports cross-datacenter communication, transparent
proxies, intentions, and all other Consul service mesh features. 

The terminating gateway must have [the appropriate IAM permissions](/docs/lambda/requirements#allow-envoy-to-invoke-the-lambda)
to invoke the function.

The following diagram shows the invocation procedure:

<ImageConfig width={700}>

![Terminating Gateway to Lambda](/img/terminating_gateway_to_lambda.svg)

</ImageConfig>

1. Make an HTTP request to the local Connect proxy.
1. The Connect proxy forwards the request to the terminating gateway.
1. The terminating gateway invokes the function.

### Connect Proxy

You can invoke Lambda functions directly from a service's Connect proxy.
This method has the following limitations:
- Intentions are unsupported. Consul enforces intentions by validating the client certificates presented when a connection is received. Lambda does not support client certificate validation, which prevents Consul from supporting intentions using this method.
- Transparent proxies are unsupported - Lambda services are not
  registered to a proxy, so transparent proxying is not supported.

This approach is secure because the correct AWS IAM permissions are required to invoke Lambda functions. Additionally, invocation takes place over Amazonâ€™s TLS. The Envoy sidecar proxy must have the correct AWS IAM credentials to invoke the function.
You can define the credentials in environment variables, EC2 metadata or ECS
task metadata.

The following diagram shows the invocation procedure:

<ImageConfig width={400}>

![Connect Proxy to Lambda](/img/connect_proxy_to_lambda.svg)

</ImageConfig>

1. Make an HTTP request to the local Connect proxy.
2. The Connect proxy invokes the Lambda.

## Invoking the Lambda

### Assumptions
This section gives an example of invoking a Lambda function. In this example, we have the following services:

* A service named `api` is registered and running on Consul service mesh.
* A Lambda service named `authentication` [is registered into Consul](/docs/lambda/registration/overview).

### Use the Lambda Service as an Upstream

Update the `api` service's proxy registration configuration to use the
`authentication` service as an upstream:

```hcl
upstreams {
  local_bind_port = 2345
  destination_name = "authentication"
}
```

Store the configuration with `consul services register api-sidecar-proxy.hcl`.

### Invoke the Lambda Service

Now that the Lambda is configured with the `authentication` service, you can run `curl localhost:2345` from `api` to invoke the `authentication` service. This invokes the Lambda function associated with the `authentication` service.
